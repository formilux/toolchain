PATCH_LIST=

function do_config {
    # To find these options, try "./Configure TABLE" and "./Configure LIST".
    ./Configure --prefix=/usr -DSSL_ALLOW_ADH --openssldir=/usr/share/openssl threads shared "linux-elf:$CC:-DL_ENDIAN -DTERMIO $GCC_ARCH_COMMON $GCC_CPU_COMMON $GCC_OPT_SMALL -Wall::-D_REENTRANT:-ldl:BN_LLONG \${x86_gcc_des} \${x86_gcc_opts}:\${x86_elf_asm}:dlfcn:linux-shared:-fPIC::.so.\\\$(SHLIB_MAJOR).\\\$(SHLIB_MINOR)"
}

function do_compile_only {
    # build libcrypto.a, libssl.a and openssl
    $FLXPMAKE
    # build libcrypto.so.<version>, libssl.so.<version>
    #$FLXMAKE build-shared SHLIB_TARGET=linux-shared SHARED_LIBS_LINK_EXTS=.so SHLIB_EXT='.so.$(SHLIB_VERSION_NUMBER)'
    $FLXPMAKE build-shared
    # rebuild openssl using the .so
    rm apps/openssl
    # Since this silly makefile systematically removes the shared libs, we'll
    # set a dependency on them to that it will relink them before linking openssl
    $FLXPMAKE -C apps DLIBCRYPTO=../libcrypto.so
}

function do_prepack {
    local SONAME

    #$FLXMAKE install MANDIR=/usr/man INSTALL_PREFIX=$ROOTDIR
    $FLXMAKE install INSTALL_PREFIX=$ROOTDIR
    #cp libcrypto.so.0.* $ROOTDIR/usr/lib/libcrypto-${PKGVER}.so
    #cp libssl.so.0.* $ROOTDIR/usr/lib/libssl-${PKGVER}.so
    #ln -s libcrypto-${PKGVER}.so $ROOTDIR/usr/lib/libcrypto.so
    #ln -s libssl-${PKGVER}.so $ROOTDIR/usr/lib/libssl.so
    #rm -f $ROOTDIR/usr/lib/libcrypto.so.${PKGVER} ; ln -s libcrypto-${PKGVER}.so $ROOTDIR/usr/lib/libcrypto.so.${PKGVER}
    #rm -f $ROOTDIR/usr/lib/libssl.so.${PKGVER} ; ln -s libssl-${PKGVER}.so $ROOTDIR/usr/lib/libssl.so.${PKGVER}

    set -- $(objdump -p $ROOTDIR/usr/lib/libcrypto.so|grep SONAME)
    SONAME=${2%%[0-9]*}
    SONAME=${2##$SONAME}

    mv $ROOTDIR/usr/lib/libcrypto.so.${SONAME} $ROOTDIR/usr/lib/libcrypto-${PKGVER}.so && ln -s libcrypto-${PKGVER}.so $ROOTDIR/usr/lib/libcrypto.so.${SONAME}
    mv $ROOTDIR/usr/lib/libssl.so.${SONAME} $ROOTDIR/usr/lib/libssl-${PKGVER}.so && ln -s libssl-${PKGVER}.so $ROOTDIR/usr/lib/libssl.so.${SONAME}

    mkdir -p $ROOTDIR/etc/profile.d && cp $PKGDIR/add-ons/openssl.var $ROOTDIR/etc/profile.d/
    set_default_perm $ROOTDIR
}

